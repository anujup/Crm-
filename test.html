<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CRM App</title>
<style>
:root {
    --bg: #ffffff;
    --card: #ffffff;
    --accent: #FF7400;
    --muted: #6b7280;
    --danger: #ef4444;
    --success: #10b981;
    --orange: #f59e0b;
    --glass: rgba(255, 255, 255, 0.6);
}

* {
    box-sizing: border-box;
}


body,
html,
#crm-app {
    font-family: Inter, ui-sans-serif, system-ui, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    margin: 0;
    padding: 0;
    background: var(--bg);
    color: #111;
}

/* Container */
#crmContainer {
    max-width: 1150px;
    padding: 0;
    width: 100vw;
    height: 80vh;
}

/* Header */
.topbar {
    width: 100vw;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: linear-gradient(90deg, #fff, #fbfbff);
    padding: 10px 16px;
    box-shadow: 0 6px 18px rgba(20, 20, 50, 0.06);
    position: sticky;
    top: 0;
    z-index: 40;
}

.brand {
    display: flex;
    align-items: center;
    gap: 12px;
}

.brand-logo {
    width: 42px;
    height: 42px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-weight: 700;
    box-shadow: 0 2px 4px rgba(107, 92, 230, 0.18);
}
.brand-logo > img{
    width:40px;
}

.brand h1 {
    font-size: 18px;
    margin: 0;
}

.top-actions {
    display: flex;
    gap: 8px;
    align-items: center;
}

#loginBox {
    width:320px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);

}

/* Buttons */
.btn {
    background: var(--accent);
    color: #000;
    border: black;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 6px 18px rgba(20, 20, 50, 0.04);
  
}

.btn.alt {
    background: #fff;
    color: var(--accent);
    border: 1px solid rgba(107, 92, 230, 0.12);
}

.icon-btn {
    background: #ffffff;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #eee;
    cursor: pointer;
}

/* Layout */
.main {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: 16px;
    margin-top: 16px;
}

.sidebar {
    width: 260px;
    background: var(--card);
    padding: 12px;

    box-shadow: 0 6px 18px rgba(20, 20, 50, 0.04);
    border: 1px solid #ddd;
    border-radius:12px;
    transition: transform 0.3s ease-in-out;
}

.content {
    min-height: 60vh;
}

/* Dashboard cards */
.dash-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;

}

.dash-cards {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.dash-card {
    flex: 1;
    min-width: 120px;
    background: linear-gradient(180deg, #fff, #fbfbff);
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #e2e5e9;;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.dash-card.active {
    box-shadow: 0 8px 24px rgba(107, 92, 230, 0.08);
    transform: translateY(-3px);
    border-color: var(--accent);
}

.dash-card strong {
    display: block;
    font-size: 14px;
}

.dash-card .num {
    font-size: 18px;
    font-weight: 700;
}

/* Card view */
.card-view {
    box-shadow: 0 8px 30px rgba(20, 20, 50, 0.06);
    background: var(--card);
    padding: 16px;
    border-radius: 12px;
    border: 1px solid #e2e5e9;
    margin: 0 8px;
}

.cust-grid {
    display: flex;
    gap: 18px;
    align-items: flex-start;
    flex-wrap: wrap;
}

.cust-details {
    flex: 1;
    min-width: 260px;

}

.cust-actions {
    width: 260px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.field {
    margin-bottom: 8px;
}

.field strong {
    display: block;
    color: var(--muted);
    font-size: 12px;
    margin-bottom: 6px;
}

.field > input,
select {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #e6e6ef;
    width: 100%;
    font-size: 14px;
}

.call-big {
    background: var(--success);
    color: #fff;
    padding: 12px;
    border-radius: 10px;
    border: none;
    font-weight: 700;
    cursor: pointer;
}

.small {
    font-size: 13px;
    color: var(--muted);
}

/* Table */
.table-wrap {
    background: var(--card);
    padding: 12px;
    border-radius: 12px;
    box-shadow: 0 8px 30px rgba(20, 20, 50, 0.04);
}

table {
    width: 100%;
    border-collapse: collapse;
}

th,
td {
    padding: 10px 8px;
    text-align: left;
    border-bottom: 1px solid #f0f0f5;
    font-size: 14px;
}

th {
    background: #fafaff;
    color: #333;
    font-weight: 700;
}

tr:hover td {
    background: #fcfcff;
}

select[disabled],
input[disabled] {
    background: #f8f8fb;
    color: #9aa0b0;
}

/* Admin */
.admin-panel {
    background: var(--card);
    padding: 14px;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(20, 20, 50, 0.04);
}

.flex-between {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#sidebarToggle{
    border:none;
    box-shadow:none;
    
}
#logoutTop{
    color: var(--accent)
}

/* Responsive */
@media (max-width: 900px) {

    .main {
        grid-template-columns: 1fr;
        padding-bottom: 40px;
    }

    .cust-actions {
        width: 100%;
    }
    .cust-details{
        display: grid !important;
        grid-template-columns: 2fr 1fr;
        gap: 12px;
        border-bottom: 2px solid #e2e5e9;
        padding-bottom: 32px;

    }

    /* Sidebar */
    .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
        transform: translateX(-100%);
        z-index: 1000;
    }

    .sidebar.open {
        transform: translateX(0);
    }

    /* Optional overlay */
    .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        z-index: 999;
    }

    .sidebar-overlay.active {
        display: block;
    }
}
</style>



  <!-- Import a font (Inter) since Elementor loaded it for you -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

</head>
<body>
  <!-- Your Elementor HTML block pasted here -->

<div id="crm-app">
  <div id="crmContainer">
    <!-- Topbar -->
    <div class="topbar">
      <div class="brand">
        <div class="brand-logo">
          <img src="https://mediaforge.in/wp-content/uploads/2025/02/cropped-Untitled-design-11-fotor-bg-remover-20250202191848-1.png" />
        </div>
        <h1>Sales CRM</h1>
      </div>

      <div class="top-actions">
        <div id="userLabel" class="small" style="margin-right:12px"></div>
        <button id="gotoAdminBtn" class="icon-btn alt" title="Admin" style="display:none">Admin</button>
        <button id="sidebarToggle" class="btn icon-btn">â˜°</button>
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
      </div>
    </div>

    <!-- Login -->
    <div id="loginBox" class="card-view" style="margin-top:18px;max-width:420px">
      <h3 style="margin:0 0 12px 0;color:black">Enter your credentials</h3>
      <div class="field">
        <input id="username" type="text" placeholder="Username" />
      </div>
      <div class="field">
        <input id="password" type="password" placeholder="Password" />
      </div>
      <div style="display:flex; flex-direction:column; gap:8px; align-items:center">
        <button id="loginBtn" class="btn">Login</button>
        <div id="loginError" style="color:var(--danger);font-weight:600"></div>
      </div>
    </div>

    <!-- App layout -->
    <div class="main" id="appLayout" style="display:none">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="dash-grid">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <div><strong class="small">Dashboard</strong></div>
            <div class="small" id="agentTimeDisplay">--:--:--</div>
          </div>

          <div class="dash-cards" id="dashCards">
            <div class="dash-card" data-filter="Total">
              <div><strong>Total</strong><div class="num" id="totalCount">0</div></div>
            </div>
            <div class="dash-card" data-filter="Interested">
              <div><strong>Interested</strong><div class="num" id="interestedCount">0</div></div>
            </div>
            <div class="dash-card" data-filter="Not Interested">
              <div><strong>Not Interested</strong><div class="num" id="notInterestedCount">0</div></div>
            </div>
            <div class="dash-card active" data-filter="Pending">
              <div><strong>Pending</strong><div class="num" id="pendingCount">0</div></div>
            </div>
            <div class="dash-card" data-filter="Follow-up">
              <div><strong>Follow-up</strong><div class="num" id="followupCount">0</div></div>
            </div>
          </div>

          <div style="margin-top:10px">
            <small class="small">Quick actions</small>
            <div style="display:flex; gap:8px; margin-top:8px">
              <button id="refreshBtn" class="btn alt">Refresh</button>
              <button id="logoutTop" class="icon-btn" style="display:none;">Logout</button>
              <button id="adminOpenBtn" class="btn alt" style="display:none;">Admin</button>
            </div>
          </div>
        </div>
      </aside>

      <!-- Content -->
      <section class="content">
        <!-- Card / Table container -->
        <div id="contentArea"></div>

        <!-- Admin container -->
        <div id="adminPanel" style="display:none; margin-top:16px">
          <div class="admin-panel">
            <div class="flex-between">
              <h3 style="margin:0; color:var(--accent)">Admin Panel</h3>
              <div>
                <input id="newUsername" placeholder="username" style="padding:8px; border-radius:8px; border:1px solid #eee" />
                <input id="newPassword" placeholder="password" style="padding:8px; border-radius:8px; border:1px solid #eee" />
                <button id="addUserBtn" class="btn alt">Add</button>
              </div>
            </div>

            <div style="margin-top:12px; display:flex; gap:12px; align-items:center">
              <label>Lunch Time:</label>
              <input type="time" id="adminLunchTime" />
              <button id="setLunchTimeBtn" class="btn alt">Set</button>

              <label style="margin-left:20px">Filter date:</label>
              <input type="date" id="filterDate" />
              <input type="time" id="filterTime" />
              <button id="applyFilterBtn" class="btn alt">Apply</button>
            </div>

            <div style="margin-top:14px; overflow:auto">
              <table id="employeeTable">
                <thead>
                  <tr>
                    <th>Username</th>
                    <th>Total Login Time</th>
                    <th>Total Cust</th>
                    <th>Interested</th>
                    <th>Not Int</th>
                    <th>Pending</th>
                    <th>Follow-up</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div id="empCustomerDetails" style="margin-top:14px; display:none">
              <h4>Employee Customers</h4>
              <div id="empCustomerContainer"></div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Lunch popup -->
  <div id="lunchPopupModal" 
       style="display:none; position:fixed; inset:0; align-items:center; justify-content:center; z-index:9999;">
    <div style="background:var(--accent); padding:20px; border-radius:12px; box-shadow:0 20px 60px rgba(107,92,230,0.2); min-width:280px; text-align:center">
      <h3 style="margin:0 0 8px 0">Lunch Time</h3>
      <div style="font-size:22px; font-weight:700">
        <span id="lunchCountdown">30:00</span>
      </div>
    </div>
  </div>
</div>


<script>
/* ---------------------------
   CONFIG / STORAGE / HELPERS
--------------------------- */
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTOtS2GnTFyub_OiySTKw_6Uu6d-GfRpUZ7VHePUamzXS3LxTVgWzZRoAO1xA9O7HQ9W_1IELtChcA9/pub?output=csv";
const DEFAULT_USERS = { agent1:"pass1", agent2:"pass2", agent3:"pass3", admin:"adminpass" };
if (!localStorage.getItem('users')) {
  localStorage.setItem('users', JSON.stringify(DEFAULT_USERS));
}

let customers = [];
let headers = [];
let currentAgent = null;
let loginSessions = [];
let loginTimer = null;
let currentFilter = "Pending";
let filteredCustomers = [];
let currentIndex = 0;

function maskPhone(phone) {
  if (!phone) return "";
  const digits = phone.replace(/\D/g,'');
  if (digits.length < 6) return phone;
  return digits.replace(/(\d{4})\d{4}(\d{2})/, '$1****$2');
}

// Simple CSV parser
async function fetchCSV() {
  try {
    const res = await fetch(CSV_URL);
    const txt = await res.text();
    const lines = txt.split(/\r?\n/).filter(l => l.trim() !== '');
    if (lines.length === 0) return;

    headers = lines[0].split(',').map(h => h.trim());
    customers = lines.slice(1).map(line => {
      const row = {};
      const cols = line.split(',');
      headers.forEach((h,i) => row[h] = (cols[i] || "").trim());
      return row;
    }).filter(r => r['Name'] && r['Phone']);
  } catch (e) {
    console.error("CSV fetch error:", e);
    alert("Could not load customer sheet. Check CSV URL or network.");
  }
}

function formatSecs(sec) {
  sec = Math.max(0, Math.floor(sec));
  const h = String(Math.floor(sec/3600)).padStart(2,'0');
  sec %= 3600;
  const m = String(Math.floor(sec/60)).padStart(2,'0');
  const s = String(sec%60).padStart(2,'0');
  return `${h}:${m}:${s}`;
}

/* ---------------------------
   AUTH & LOGIN / LOGOUT
--------------------------- */
document.getElementById('loginBtn').addEventListener('click', async () => {
  const u = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value.trim();
  const users = JSON.parse(localStorage.getItem('users') || '{}');

  if (users[u] && users[u] === p) {
    currentAgent = u;
    localStorage.setItem("loggedInUser", u);

    document.getElementById('loginBox').style.display = 'none';
    document.getElementById('appLayout').style.display = 'grid';
    document.getElementById('userLabel').innerText = `User: ${u}`;
    document.getElementById('logoutTop').style.display = 'inline-block';
    document.getElementById('gotoAdminBtn').style.display = (u==='admin') ? 'inline-block' : 'none';
    document.getElementById('adminOpenBtn').style.display = (u==='admin') ? 'inline-block' : 'none';

    await initAfterLogin();
    handleSidebarToggleVisibility();
  } else {
    document.getElementById('loginError').innerText = "Invalid credentials";
    setTimeout(() => document.getElementById('loginError').innerText = '', 2500);
  }
});

document.getElementById('logoutTop').addEventListener('click', () => {
  if (!currentAgent) return;

  let sessions = JSON.parse(localStorage.getItem(`sessions-${currentAgent}`) || '[]');
  if (sessions.length && sessions[sessions.length - 1].end === null) {
    sessions[sessions.length - 1].end = Date.now();
  }
  localStorage.setItem(`sessions-${currentAgent}`, JSON.stringify(sessions));
  localStorage.setItem(`currentIndex-${currentAgent}`, currentIndex);

  localStorage.removeItem("loggedInUser");
  currentAgent = null;

  document.getElementById('appLayout').style.display = 'none';
  document.getElementById('loginBox').style.display = 'block';
  document.getElementById('username').value = "";
  document.getElementById('password').value = "";
  document.getElementById('userLabel').innerText = "";
  document.getElementById('logoutTop').style.display = 'none';
  document.getElementById('gotoAdminBtn').style.display = 'none';
  document.getElementById('adminOpenBtn').style.display = 'none';
});

/* ---------------------------
   APP INIT AFTER LOGIN
--------------------------- */
async function initAfterLogin(skipCSV) {
  if (!skipCSV) await fetchCSV();

  if (currentAgent === 'admin') {
    document.getElementById('adminPanel').style.display = 'block';
    document.getElementById('contentArea').style.display = 'none';
    loadUsersTable();
    document.getElementById('adminLunchTime').value = localStorage.getItem('lunchTime') || '14:30';
    return;
  }

  document.getElementById('adminPanel').style.display = 'none';
  document.getElementById('contentArea').style.display = 'block';

  let sessions = JSON.parse(localStorage.getItem(`sessions-${currentAgent}`) || '[]');
  sessions.push({start: Date.now(), end: null});
  localStorage.setItem(`sessions-${currentAgent}`, JSON.stringify(sessions));

  loginSessions = sessions;
  startLoginTimer();

  currentFilter = 'Pending';
  currentIndex = parseInt(localStorage.getItem(`currentIndex-${currentAgent}`) || 0);
  applyFilter(currentFilter);
  startLunchChecker();
}

/* ---------------------------
   DASHBOARD / FILTERS
--------------------------- */
// ... keep your renderCardView, renderTableView, updateDashboardCounts exactly as before
// (no changes except formatting)

/* ---------------------------
   SIDEBAR TOGGLE
--------------------------- */
const sidebar = document.querySelector('.sidebar');
const sidebarToggle = document.getElementById('sidebarToggle');
const sidebarOverlay = document.getElementById('sidebarOverlay');

sidebarToggle.addEventListener('click', () => {
  sidebar.classList.toggle('open');
  sidebarOverlay.classList.toggle('active');
});
sidebarOverlay.addEventListener('click', () => {
  sidebar.classList.remove('open');
  sidebarOverlay.classList.remove('active');
});
document.getElementById('contentArea').addEventListener('click', () => {
  sidebar.classList.remove('open');
  sidebarOverlay.classList.remove('active');
});

function handleSidebarToggleVisibility() {
  const loginBox = document.getElementById('loginBox');
  const loginVisible = loginBox && getComputedStyle(loginBox).display !== 'none';
  const smallScreen = window.matchMedia("(max-width: 768px)").matches;
  sidebarToggle.style.display = (loginVisible || !smallScreen) ? 'none' : 'inline-block';
}
function setupSidebarToggleLogic() {
  handleSidebarToggleVisibility();
  window.addEventListener('resize', handleSidebarToggleVisibility);
}
setupSidebarToggleLogic();

/* ---------------------------
   AUTO LOGIN (on refresh)
--------------------------- */
window.addEventListener("load", async () => {
  const savedUser = localStorage.getItem("loggedInUser");
  if (savedUser) {
    currentAgent = savedUser;
    document.getElementById('loginBox').style.display = 'none';
    document.getElementById('appLayout').style.display = 'grid';
    document.getElementById('userLabel').innerText = `User: ${savedUser}`;
    document.getElementById('logoutTop').style.display = 'inline-block';
    document.getElementById('gotoAdminBtn').style.display = (savedUser === 'admin') ? 'inline-block' : 'none';
    document.getElementById('adminOpenBtn').style.display = (savedUser === 'admin') ? 'inline-block' : 'none';
    await initAfterLogin();
    handleSidebarToggleVisibility();
  }
});

/* ---------------------------
   INITIAL LOAD
--------------------------- */
(async function init(){
  await fetchCSV();
  loadUsersTable();
})();

</script>
</body>
</html>

<!-- shsPROFESSIONAL CRM UI (single HTML block) -->
 
